<div class="workout-detail-container">
  @if (currentPlan(); as plan) {
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()" title="Zur√ºck zur √úbersicht">
        <span class="material-icons">arrow_back</span>
        <span class="back-text">Zur√ºck</span>
      </button>
      <div class="plan-title">
        <h1>{{ plan.name }}</h1>
        @if (!plan.isActive) {
        <span class="status-badge inactive">Inaktiv</span>
        }
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="showEditPlan()">
        <span class="material-icons">edit</span>
        Plan bearbeiten
      </button>
      <button class="btn btn-primary" (click)="showCreateExercise()"
        [disabled]="showCreateExerciseForm() || editingExercise()">
        <span class="material-icons">add</span>
        √úbung hinzuf√ºgen
      </button>
    </div>
  </header>

  <!-- Plan Info -->
  <div class="plan-info">
    @if (plan.description) {
    <p class="plan-description">{{ plan.description }}</p>
    }
    <div class="plan-stats">
      <div class="stat">
        <span class="stat-value">{{ plan.exercises.length }}</span>
        <span class="stat-label">√úbungen</span>
      </div>
      <div class="stat">
        <span class="stat-value">{{ calculateTotalVolume() }}</span>
        <span class="stat-label">Gesamtvolumen (kg)</span>
      </div>
      <div class="stat">
        <span class="stat-value">{{ formatDate(plan.updatedAt) }}</span>
        <span class="stat-label">Zuletzt bearbeitet</span>
      </div>
    </div>
  </div>

  <!-- Plan Edit Form -->
  @if (showEditPlanForm()) {
  <div class="form-overlay">
    <div class="form-container">
      <div class="form-header">
        <h2>Trainingsplan bearbeiten</h2>
        <button class="btn-close" (click)="hideEditPlan()">√ó</button>
      </div>
      <form (ngSubmit)="savePlan()" #editPlanForm="ngForm">
        <div class="form-body">
          <div class="form-group">
            <label for="editPlanName">Name des Trainingsplans *</label>
            <input type="text" id="editPlanName" [(ngModel)]="editPlanName" (ngModelChange)="editPlanName.set($event)"
              name="editPlanName" class="form-control" required maxlength="100">
          </div>
          <div class="form-group">
            <label for="editPlanDescription">Beschreibung</label>
            <textarea id="editPlanDescription" [(ngModel)]="editPlanDescription"
              (ngModelChange)="editPlanDescription.set($event)" name="editPlanDescription" class="form-control" rows="3"
              maxlength="500"></textarea>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="editPlanIsActive" (ngModelChange)="editPlanIsActive.set($event)"
                name="editPlanIsActive">
              <span class="checkmark"></span>
              Plan ist aktiv
            </label>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="hideEditPlan()">
            Abbrechen
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!editPlanName().trim()">
            Speichern
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Exercise Create/Edit Form -->
  @if (showCreateExerciseForm() || editingExercise()) {
  <div class="form-overlay">
    <div class="form-container exercise-form">
      <div class="form-header">
        <h2>{{ editingExercise() ? '√úbung bearbeiten' : 'Neue √úbung erstellen' }}</h2>
        <button class="btn-close" (click)="editingExercise() ? cancelEditExercise() : hideCreateExercise()">√ó</button>
      </div>
      <form (ngSubmit)="editingExercise() ? saveExercise() : createExercise()" #exerciseForm="ngForm">
        <div class="form-body">
          <div class="form-group">
            <label for="exerciseName">√úbungsname *</label>
            <input type="text" id="exerciseName" [(ngModel)]="newExerciseName"
              (ngModelChange)="newExerciseName.set($event)" name="exerciseName" class="form-control"
              placeholder="z.B. Bankdr√ºcken" required maxlength="100">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="exerciseSets">S√§tze</label>
              <input type="number" id="exerciseSets" [(ngModel)]="newExerciseSets"
                (ngModelChange)="newExerciseSets.set($event)" name="exerciseSets" class="form-control" min="1" max="50"
                required>
            </div>
            <div class="form-group">
              <label for="exerciseReps">Wiederholungen</label>
              <input type="number" id="exerciseReps" [(ngModel)]="newExerciseReps"
                (ngModelChange)="newExerciseReps.set($event)" name="exerciseReps" class="form-control" min="1" max="100"
                required>
            </div>
            <div class="form-group">
              <label for="exerciseWeight">Gewicht (kg)</label>
              <input type="number" id="exerciseWeight" [(ngModel)]="newExerciseWeight"
                (ngModelChange)="newExerciseWeight.set($event)" name="exerciseWeight" class="form-control" min="0"
                step="0.5" required>
            </div>
            <div class="form-group">
              <label for="exerciseRestTime">Pause (Sekunden)</label>
              <input type="number" id="exerciseRestTime" [(ngModel)]="newExerciseRestTime"
                (ngModelChange)="newExerciseRestTime.set($event)" name="exerciseRestTime" class="form-control" min="0"
                max="600">
            </div>
          </div>
          <div class="form-group">
            <label for="exerciseNotes">Notizen (optional)</label>
            <textarea id="exerciseNotes" [(ngModel)]="newExerciseNotes" (ngModelChange)="newExerciseNotes.set($event)"
              name="exerciseNotes" class="form-control" rows="3"
              placeholder="z.B. Langsam absenken, volle Bewegungsamplitude..." maxlength="300"></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary"
            (click)="editingExercise() ? cancelEditExercise() : hideCreateExercise()">
            Abbrechen
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!newExerciseName().trim()">
            {{ editingExercise() ? 'Speichern' : 'Erstellen' }}
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Exercises List -->
  <div class="exercises-section">
    <h2>√úbungen ({{ plan.exercises.length }})</h2>

    @if (plan.exercises.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üèãÔ∏è‚Äç‚ôÇÔ∏è</div>
      <h3>Noch keine √úbungen hinzugef√ºgt</h3>
      <p>F√ºgen Sie Ihre erste √úbung hinzu, um mit dem Training zu beginnen!</p>
      <button class="btn btn-primary" (click)="showCreateExercise()">
        Erste √úbung hinzuf√ºgen
      </button>
    </div>
    } @else {
    <div class="exercises-list">
      @for (exercise of plan.exercises; track exercise.id; let i = $index) {
      <div class="exercise-card" [class.editing]="editingExercise()?.id === exercise.id">
        <div class="exercise-header">
          <div class="exercise-number">{{ i + 1 }}</div>
          <div class="exercise-title">
            <h3>{{ exercise.name }}</h3>
            @if (exercise.notes) {
            <p class="exercise-notes">{{ exercise.notes }}</p>
            }
          </div>
          <div class="exercise-actions">
            <button class="btn-icon" (click)="duplicateExercise(exercise)" title="Duplizieren">
              <span class="material-icons">content_copy</span>
            </button>
            <button class="btn-icon" (click)="startEditExercise(exercise)" title="Bearbeiten"
              [disabled]="editingExercise() !== null">
              <span class="material-icons">edit</span>
            </button>
            <button class="btn-icon danger" (click)="deleteExercise(exercise.id, exercise.name)" title="L√∂schen">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>

        <div class="exercise-details">
          <div class="exercise-params">
            <div class="param">
              <span class="param-value">{{ exercise.sets }}</span>
              <span class="param-label">S√§tze</span>
            </div>
            <div class="param">
              <span class="param-value">{{ exercise.reps }}</span>
              <span class="param-label">Wdh.</span>
            </div>
            <div class="param">
              <span class="param-value">{{ exercise.weight }}</span>
              <span class="param-label">kg</span>
            </div>
            <div class="param">
              <span class="param-value">{{ formatRestTime(exercise.restTime) }}</span>
              <span class="param-label">Pause</span>
            </div>
            <div class="param volume">
              <span class="param-value">{{ calculateVolume(exercise) }}</span>
              <span class="param-label">Volumen (kg)</span>
            </div>
          </div>
        </div>

        <div class="exercise-meta">
          <small>Erstellt: {{ formatDate(exercise.createdAt) }}</small>
          @if (exercise.updatedAt.getTime() !== exercise.createdAt.getTime()) {
          <small>Bearbeitet: {{ formatDate(exercise.updatedAt) }}</small>
          }
        </div>
      </div>
      }
    </div>
    }
  </div>
  } @else {
  <!-- Loading oder Fehler -->
  <div class="empty-state">
    <div class="empty-icon">‚ùå</div>
    <h3>Trainingsplan nicht gefunden</h3>
    <p>Der angeforderte Trainingsplan existiert nicht oder wurde gel√∂scht.</p>
    <button class="btn btn-primary" (click)="goBack()">
      Zur√ºck zur √úbersicht
    </button>
  </div>
  }
</div>